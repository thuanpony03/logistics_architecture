2024-12-26 15:10:45,839 - __main__ - INFO - Starting logistics data pipeline
User: ponydasierra
Environment: development
Start Time (UTC): 2024-12-26 08:10:43.220710
2024-12-26 15:10:45,839 - __main__ - INFO - Starting data extraction phase
2024-12-26 15:10:45,839 - __main__ - INFO - Processing table: Orders
2024-12-26 15:10:45,839 - src.extract.mysql_extractor - INFO - Starting extraction of table Orders
2024-12-26 15:10:48,443 - src.extract.mysql_extractor - INFO - Completed extraction of Orders:
Records: 5,000
Partitions: 4
Duration: 2.17 seconds
2024-12-26 15:10:48,564 - src.load.datalake_loader - INFO - Starting raw zone load for Orders
2024-12-26 15:10:49,870 - src.load.datalake_loader - INFO - Completed raw zone load for Orders:
Records: 5,000
Partitioning: partitioned by ['created_at_partition', 'status']
Duration: 1.23 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Orders
2024-12-26 15:10:49,870 - __main__ - INFO - Completed Orders: 5,000 records processed in 4.03 seconds
2024-12-26 15:10:49,870 - __main__ - INFO - Processing table: Shipments
2024-12-26 15:10:49,870 - src.extract.mysql_extractor - INFO - Starting extraction of table Shipments
2024-12-26 15:10:50,019 - src.extract.mysql_extractor - INFO - Completed extraction of Shipments:
Records: 3,756
Partitions: 4
Duration: 0.05 seconds
2024-12-26 15:10:50,068 - src.load.datalake_loader - INFO - Starting raw zone load for Shipments
2024-12-26 15:10:50,735 - src.load.datalake_loader - INFO - Completed raw zone load for Shipments:
Records: 3,756
Partitioning: partitioned by ['status']
Duration: 0.62 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Shipments
2024-12-26 15:10:50,736 - __main__ - INFO - Completed Shipments: 3,756 records processed in 0.87 seconds
2024-12-26 15:10:50,736 - __main__ - INFO - Processing table: Payments
2024-12-26 15:10:50,736 - src.extract.mysql_extractor - INFO - Starting extraction of table Payments
2024-12-26 15:10:50,838 - src.extract.mysql_extractor - INFO - Completed extraction of Payments:
Records: 5,000
Partitions: 4
Duration: 0.04 seconds
2024-12-26 15:10:50,917 - src.load.datalake_loader - INFO - Starting raw zone load for Payments
2024-12-26 15:10:51,976 - src.load.datalake_loader - INFO - Completed raw zone load for Payments:
Records: 5,000
Partitioning: partitioned by ['payment_date_partition', 'payment_status']
Duration: 1.02 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Payments
2024-12-26 15:10:51,976 - __main__ - INFO - Completed Payments: 5,000 records processed in 1.24 seconds
2024-12-26 15:10:51,976 - __main__ - INFO - Processing table: Notifications
2024-12-26 15:10:51,976 - src.extract.mysql_extractor - INFO - Starting extraction of table Notifications
2024-12-26 15:10:52,056 - src.extract.mysql_extractor - INFO - Completed extraction of Notifications:
Records: 3,756
Partitions: 4
Duration: 0.03 seconds
2024-12-26 15:10:52,099 - src.load.datalake_loader - INFO - Starting raw zone load for Notifications
2024-12-26 15:10:52,312 - src.load.datalake_loader - INFO - Completed raw zone load for Notifications:
Records: 3,756
Partitioning: partitioned by ['notification_date_partition']
Duration: 0.17 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Notifications
2024-12-26 15:10:52,312 - __main__ - INFO - Completed Notifications: 3,756 records processed in 0.34 seconds
2024-12-26 15:10:52,312 - __main__ - INFO - Processing table: Users
2024-12-26 15:10:52,312 - src.extract.mysql_extractor - INFO - Starting extraction of table Users
2024-12-26 15:10:52,371 - src.extract.mysql_extractor - INFO - Completed extraction of Users:
Records: 1,000
Partitions: 1
Duration: 0.01 seconds
2024-12-26 15:10:52,405 - src.load.datalake_loader - INFO - Starting raw zone load for Users
2024-12-26 15:10:52,542 - src.load.datalake_loader - INFO - Completed raw zone load for Users:
Records: 1,000
Partitioning: not partitioned
Duration: 0.10 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Users
2024-12-26 15:10:52,542 - __main__ - INFO - Completed Users: 1,000 records processed in 0.23 seconds
2024-12-26 15:10:52,542 - __main__ - INFO - Processing table: Drivers
2024-12-26 15:10:52,542 - src.extract.mysql_extractor - INFO - Starting extraction of table Drivers
2024-12-26 15:10:52,609 - src.extract.mysql_extractor - INFO - Completed extraction of Drivers:
Records: 200
Partitions: 1
Duration: 0.01 seconds
2024-12-26 15:10:52,662 - src.load.datalake_loader - INFO - Starting raw zone load for Drivers
2024-12-26 15:10:52,778 - src.load.datalake_loader - INFO - Completed raw zone load for Drivers:
Records: 200
Partitioning: not partitioned
Duration: 0.08 seconds
Path: hdfs://localhost:9000/user/thuanpony03/logistics/data/datalake/raw/Drivers
2024-12-26 15:10:52,779 - __main__ - INFO - Completed Drivers: 200 records processed in 0.24 seconds
2024-12-26 15:10:52,779 - __main__ - INFO - Data extraction phase completed in 6.94 seconds
2024-12-26 15:10:52,779 - __main__ - INFO - Starting data transformation phase
2024-12-26 15:10:52,779 - src.transform.transform_executor - INFO - Starting transformation process
Timestamp: 2024-12-24 09:43:35
User: thuanpony03
2024-12-26 15:10:52,779 - src.transform.transform_executor - INFO - Starting dimension transformation at 2024-12-24 09:43:35
2024-12-26 15:10:52,779 - src.transform.dimension_builder - INFO - Building date dimension from 2024-01-01 to 2024-12-31
2024-12-26 15:10:53,673 - src.transform.dimension_builder - INFO - Successfully built date dimension with 366 rows
2024-12-26 15:10:53,920 - src.transform.dimension_builder - INFO - Building user dimension
2024-12-26 15:10:54,105 - src.transform.dimension_builder - INFO - Successfully built user dimension with 1000 rows
2024-12-26 15:10:54,105 - src.transform.dimension_builder - INFO - Building driver dimension
2024-12-26 15:10:54,425 - src.transform.dimension_builder - INFO - Successfully built driver dimension with 200 rows
2024-12-26 15:10:54,439 - src.transform.dimension_builder - INFO - Building location dimension
2024-12-26 15:10:56,060 - src.transform.dimension_builder - INFO - Successfully built location dimension with 10000 unique addresses
2024-12-26 15:10:57,490 - src.transform.transform_executor - INFO - Completed dimension transformation with counts:
date: 366 rows
user: 1000 rows
driver: 200 rows
location: 10000 rows
2024-12-26 15:10:57,490 - src.transform.transform_executor - INFO - Starting fact transformation at 2024-12-24 09:43:35
2024-12-26 15:10:57,607 - src.transform.fact_builder - INFO - Building orders fact table
2024-12-26 15:10:58,044 - src.transform.fact_builder - INFO - Successfully built orders fact table with 5000 rows
Time range: Row(min(order_created_at)=datetime.datetime(2024, 12, 24, 20, 0, 14), max(order_created_at)=datetime.datetime(2024, 12, 24, 20, 3, 16))
2024-12-26 15:10:58,053 - src.transform.fact_builder - INFO - Building shipment tracking fact table
2024-12-26 15:10:58,520 - src.transform.fact_builder - INFO - Successfully built shipment tracking fact table with 3756 rows
2024-12-26 15:10:59,482 - src.transform.transform_executor - INFO - Completed fact transformation
Built facts: ['orders', 'shipment_tracking']
Counts: {'orders': 5000, 'shipment_tracking': 3756}
2024-12-26 15:10:59,482 - src.transform.transform_executor - INFO - Saving transformed tables to processed zone
2024-12-26 15:11:00,014 - src.load.datalake_loader - INFO - Completed processed zone load for dim_date:
Records: 366
Update Type: overwrite
Duration: 0.51 seconds
2024-12-26 15:11:00,636 - src.load.datalake_loader - INFO - Completed processed zone load for dim_user:
Records: 1,000
Update Type: overwrite
Duration: 0.59 seconds
2024-12-26 15:11:01,267 - src.load.datalake_loader - INFO - Completed processed zone load for dim_driver:
Records: 200
Update Type: overwrite
Duration: 0.55 seconds
2024-12-26 15:11:03,772 - src.load.datalake_loader - INFO - Completed processed zone load for dim_location:
Records: 10,000
Update Type: overwrite
Duration: 1.60 seconds
2024-12-26 15:11:05,742 - src.load.datalake_loader - INFO - Completed processed zone load for fact_orders:
Records: 5,000
Update Type: append
Duration: 1.86 seconds
2024-12-26 15:11:06,977 - src.load.datalake_loader - INFO - Completed processed zone load for fact_shipment_tracking:
Records: 3,756
Update Type: append
Duration: 0.79 seconds
2024-12-26 15:11:06,977 - src.transform.transform_executor - INFO - Successfully saved all transformed tables
2024-12-26 15:11:06,978 - src.transform.transform_executor - INFO - Completed transformation process
Duration: 167251.00 seconds
2024-12-26 15:11:13,746 - src.transform.transform_executor - INFO - Transform metrics generated:
Duration: 167251.00 seconds
Dimensions processed: 4
Facts processed: 2
Total errors: 0
2024-12-26 15:11:13,746 - __main__ - INFO - Data transformation phase completed in 20.97 seconds
2024-12-26 15:11:13,746 - __main__ - INFO - Starting warehouse loading phase
2024-12-26 15:11:13,759 - src.load.warehouse_loader - INFO - Starting load for dimension 'dim_date'
2024-12-26 15:11:13,804 - src.load.warehouse_loader - INFO - Truncating table 'dim_date'
2024-12-26 15:11:14,064 - src.load.warehouse_loader - ERROR - Error truncating table 'dim_date': An error occurred while calling o689.count.
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 378.0 failed 1 times, most recent failure: Lost task 0.0 in stage 378.0 (TID 1164) (192.168.0.136 executor driver): java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

Driver stacktrace:
	at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2856)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2792)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2791)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2791)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1247)
	at scala.Option.foreach(Option.scala:407)
	at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:3060)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2994)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2983)
	at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
Caused by: java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

2024-12-26 15:11:14,064 - src.load.warehouse_loader - ERROR - Error loading dimension 'dim_date': An error occurred while calling o689.count.
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 378.0 failed 1 times, most recent failure: Lost task 0.0 in stage 378.0 (TID 1164) (192.168.0.136 executor driver): java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

Driver stacktrace:
	at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2856)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2792)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2791)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2791)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1247)
	at scala.Option.foreach(Option.scala:407)
	at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:3060)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2994)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2983)
	at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
Caused by: java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

2024-12-26 15:11:14,064 - __main__ - ERROR - Error in warehouse loading phase: An error occurred while calling o689.count.
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 378.0 failed 1 times, most recent failure: Lost task 0.0 in stage 378.0 (TID 1164) (192.168.0.136 executor driver): java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

Driver stacktrace:
	at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2856)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2792)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2791)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2791)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1247)
	at scala.Option.foreach(Option.scala:407)
	at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:3060)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2994)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2983)
	at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
Caused by: java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

2024-12-26 15:11:14,065 - __main__ - ERROR - Pipeline failed: An error occurred while calling o689.count.
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 378.0 failed 1 times, most recent failure: Lost task 0.0 in stage 378.0 (TID 1164) (192.168.0.136 executor driver): java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

Driver stacktrace:
	at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2856)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2792)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2791)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2791)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1247)
	at scala.Option.foreach(Option.scala:407)
	at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1247)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:3060)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2994)
	at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2983)
	at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
Caused by: java.sql.SQLSyntaxErrorException: Cannot truncate a table referenced in a foreign key constraint (`dw_logistics`.`fact_orders`, CONSTRAINT `fact_orders_ibfk_2`)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:371)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD.compute(JDBCRDD.scala:243)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

2024-12-26 15:11:14,066 - py4j.clientserver - INFO - Closing down clientserver connection
